{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.210.0"},"children":{"AutoBookingStack":{"id":"AutoBookingStack","path":"AutoBookingStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.210.0"},"children":{"AutoBookingStateMachineLogs":{"id":"AutoBookingStateMachineLogs","path":"AutoBookingStack/AutoBookingStateMachineLogs","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/AutoBookingStateMachineLogs/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"logGroupName":"/aws/stepfunctions/auto-booking-AutoBookingStack","retentionInDays":30}}}}},"ValidateBookingInputFn":{"id":"ValidateBookingInputFn","path":"AutoBookingStack/ValidateBookingInputFn","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda_nodejs.NodejsFunction","version":"2.210.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"AutoBookingStack/ValidateBookingInputFn/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.210.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"AutoBookingStack/ValidateBookingInputFn/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.210.0","metadata":[]}},"Resource":{"id":"Resource","path":"AutoBookingStack/ValidateBookingInputFn/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AutoBookingStack/ValidateBookingInputFn/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/ValidateBookingInputFn/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["xray:PutTraceSegments","xray:PutTelemetryRecords"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"ValidateBookingInputFnServiceRoleDefaultPolicyFEA7004C","roles":[{"Ref":"ValidateBookingInputFnServiceRole0E2F28F7"}]}}}}}}},"Code":{"id":"Code","path":"AutoBookingStack/ValidateBookingInputFn/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.210.0"},"children":{"Stage":{"id":"Stage","path":"AutoBookingStack/ValidateBookingInputFn/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.210.0"}},"AssetBucket":{"id":"AssetBucket","path":"AutoBookingStack/ValidateBookingInputFn/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.210.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"AutoBookingStack/ValidateBookingInputFn/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-759262713606-us-east-1","s3Key":"e3cecc8c365dd9a1d7b0f46e91dfb7f5d0bc0339ca3d450341728822702c743e.zip"},"functionName":"validate-booking-input","handler":"index.handler","memorySize":256,"role":{"Fn::GetAtt":["ValidateBookingInputFnServiceRole0E2F28F7","Arn"]},"runtime":"nodejs20.x","timeout":10,"tracingConfig":{"mode":"Active"}}}}}},"AutoBookingStateMachineRole":{"id":"AutoBookingStateMachineRole","path":"AutoBookingStack/AutoBookingStateMachineRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.210.0","metadata":[]},"children":{"ImportAutoBookingStateMachineRole":{"id":"ImportAutoBookingStateMachineRole","path":"AutoBookingStack/AutoBookingStateMachineRole/ImportAutoBookingStateMachineRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.210.0","metadata":[]}},"Resource":{"id":"Resource","path":"AutoBookingStack/AutoBookingStateMachineRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"states.amazonaws.com"}}],"Version":"2012-10-17"},"description":"Role for Auto Booking State Machine to invoke lambdas and write logs"}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AutoBookingStack/AutoBookingStateMachineRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/AutoBookingStateMachineRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":[{"Fn::GetAtt":["ValidateBookingInputFn6CCE76E6","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["ValidateBookingInputFn6CCE76E6","Arn"]},":*"]]}]},{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":[{"Fn::GetAtt":["ProcessAutoBookingFn77636C74","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["ProcessAutoBookingFn77636C74","Arn"]},":*"]]}]},{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":[{"Fn::GetAtt":["RefundPaymentStubFn892BB54D","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["RefundPaymentStubFn892BB54D","Arn"]},":*"]]}]},{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":[{"Fn::GetAtt":["CancelBookingStubFnB7AAB940","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["CancelBookingStubFnB7AAB940","Arn"]},":*"]]}]},{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":[{"Fn::GetAtt":["PaymentStubFnD56A5A14","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["PaymentStubFnD56A5A14","Arn"]},":*"]]}]},{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":[{"Fn::GetAtt":["PaymentStripeFn7DED637D","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["PaymentStripeFn7DED637D","Arn"]},":*"]]}]},{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":[{"Fn::GetAtt":["ProviderCallbackInitiateFnB7833538","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["ProviderCallbackInitiateFnB7833538","Arn"]},":*"]]}]},{"Action":["logs:CreateLogDelivery","logs:GetLogDelivery","logs:UpdateLogDelivery","logs:DeleteLogDelivery","logs:ListLogDeliveries","logs:PutResourcePolicy","logs:DescribeResourcePolicies","logs:DescribeLogGroups"],"Effect":"Allow","Resource":"*"},{"Action":["xray:PutTraceSegments","xray:PutTelemetryRecords","xray:GetSamplingRules","xray:GetSamplingTargets"],"Effect":"Allow","Resource":"*"},{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":{"Fn::GetAtt":["ValidateBookingInputFn6CCE76E6","Arn"]}},{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":{"Fn::GetAtt":["ProcessAutoBookingFn77636C74","Arn"]}},{"Action":["logs:CreateLogStream","logs:PutLogEvents"],"Effect":"Allow","Resource":{"Fn::GetAtt":["AutoBookingStateMachineLogs08476C0D","Arn"]}}],"Version":"2012-10-17"},"policyName":"AutoBookingStateMachineRoleDefaultPolicyB99B217F","roles":[{"Ref":"AutoBookingStateMachineRoleFBA00017"}]}}}}}}},"ProcessAutoBookingFn":{"id":"ProcessAutoBookingFn","path":"AutoBookingStack/ProcessAutoBookingFn","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda_nodejs.NodejsFunction","version":"2.210.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"AutoBookingStack/ProcessAutoBookingFn/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.210.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"AutoBookingStack/ProcessAutoBookingFn/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.210.0","metadata":[]}},"Resource":{"id":"Resource","path":"AutoBookingStack/ProcessAutoBookingFn/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AutoBookingStack/ProcessAutoBookingFn/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/ProcessAutoBookingFn/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["xray:PutTraceSegments","xray:PutTelemetryRecords"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"ProcessAutoBookingFnServiceRoleDefaultPolicy91B28D5F","roles":[{"Ref":"ProcessAutoBookingFnServiceRole91D29A29"}]}}}}}}},"Code":{"id":"Code","path":"AutoBookingStack/ProcessAutoBookingFn/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.210.0"},"children":{"Stage":{"id":"Stage","path":"AutoBookingStack/ProcessAutoBookingFn/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.210.0"}},"AssetBucket":{"id":"AssetBucket","path":"AutoBookingStack/ProcessAutoBookingFn/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.210.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"AutoBookingStack/ProcessAutoBookingFn/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-759262713606-us-east-1","s3Key":"bea1c5f4c9aff4a2787df873339ad879f334486125fd242d508c6db7ca119d80.zip"},"functionName":"process-auto-booking","handler":"index.handler","memorySize":256,"role":{"Fn::GetAtt":["ProcessAutoBookingFnServiceRole91D29A29","Arn"]},"runtime":"nodejs20.x","timeout":30,"tracingConfig":{"mode":"Active"}}}}}},"RefundPaymentStubFn":{"id":"RefundPaymentStubFn","path":"AutoBookingStack/RefundPaymentStubFn","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda_nodejs.NodejsFunction","version":"2.210.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"AutoBookingStack/RefundPaymentStubFn/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.210.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"AutoBookingStack/RefundPaymentStubFn/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.210.0","metadata":[]}},"Resource":{"id":"Resource","path":"AutoBookingStack/RefundPaymentStubFn/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AutoBookingStack/RefundPaymentStubFn/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/RefundPaymentStubFn/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["xray:PutTraceSegments","xray:PutTelemetryRecords"],"Effect":"Allow","Resource":"*"},{"Action":["dynamodb:BatchGetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:Query","dynamodb:GetItem","dynamodb:Scan","dynamodb:ConditionCheckItem","dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["PaymentsIdempotencyTable0E5F63BF","Arn"]},{"Ref":"AWS::NoValue"}]},{"Action":["dynamodb:BatchGetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:Query","dynamodb:GetItem","dynamodb:Scan","dynamodb:ConditionCheckItem","dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["SagaTransactionsTable4F35CC88","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["SagaTransactionsTable4F35CC88","Arn"]},"/index/*"]]}]}],"Version":"2012-10-17"},"policyName":"RefundPaymentStubFnServiceRoleDefaultPolicyE9ACCD45","roles":[{"Ref":"RefundPaymentStubFnServiceRole34829611"}]}}}}}}},"Code":{"id":"Code","path":"AutoBookingStack/RefundPaymentStubFn/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.210.0"},"children":{"Stage":{"id":"Stage","path":"AutoBookingStack/RefundPaymentStubFn/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.210.0"}},"AssetBucket":{"id":"AssetBucket","path":"AutoBookingStack/RefundPaymentStubFn/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.210.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"AutoBookingStack/RefundPaymentStubFn/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-759262713606-us-east-1","s3Key":"862082549646dd1ecb50fa721f6b9731e650028e965bddec24dd994095ef419b.zip"},"environment":{"variables":{"PAYMENTS_IDEMPOTENCY_TABLE":{"Ref":"PaymentsIdempotencyTable0E5F63BF"},"SAGA_TRANSACTIONS_TABLE":{"Ref":"SagaTransactionsTable4F35CC88"}}},"functionName":"refund-payment-stub","handler":"index.handler","memorySize":256,"role":{"Fn::GetAtt":["RefundPaymentStubFnServiceRole34829611","Arn"]},"runtime":"nodejs20.x","timeout":15,"tracingConfig":{"mode":"Active"}}}}}},"CancelBookingStubFn":{"id":"CancelBookingStubFn","path":"AutoBookingStack/CancelBookingStubFn","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda_nodejs.NodejsFunction","version":"2.210.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"AutoBookingStack/CancelBookingStubFn/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.210.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"AutoBookingStack/CancelBookingStubFn/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.210.0","metadata":[]}},"Resource":{"id":"Resource","path":"AutoBookingStack/CancelBookingStubFn/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AutoBookingStack/CancelBookingStubFn/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/CancelBookingStubFn/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["xray:PutTraceSegments","xray:PutTelemetryRecords"],"Effect":"Allow","Resource":"*"},{"Action":["dynamodb:BatchGetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:Query","dynamodb:GetItem","dynamodb:Scan","dynamodb:ConditionCheckItem","dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["PaymentsIdempotencyTable0E5F63BF","Arn"]},{"Ref":"AWS::NoValue"}]},{"Action":["dynamodb:BatchGetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:Query","dynamodb:GetItem","dynamodb:Scan","dynamodb:ConditionCheckItem","dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["SagaTransactionsTable4F35CC88","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["SagaTransactionsTable4F35CC88","Arn"]},"/index/*"]]}]}],"Version":"2012-10-17"},"policyName":"CancelBookingStubFnServiceRoleDefaultPolicy347194B2","roles":[{"Ref":"CancelBookingStubFnServiceRoleEB147118"}]}}}}}}},"Code":{"id":"Code","path":"AutoBookingStack/CancelBookingStubFn/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.210.0"},"children":{"Stage":{"id":"Stage","path":"AutoBookingStack/CancelBookingStubFn/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.210.0"}},"AssetBucket":{"id":"AssetBucket","path":"AutoBookingStack/CancelBookingStubFn/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.210.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"AutoBookingStack/CancelBookingStubFn/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-759262713606-us-east-1","s3Key":"4d89d9519281be36e48363c3878cd93f965cd568939ed727598f89e9d7f63db0.zip"},"environment":{"variables":{"PAYMENTS_IDEMPOTENCY_TABLE":{"Ref":"PaymentsIdempotencyTable0E5F63BF"},"SAGA_TRANSACTIONS_TABLE":{"Ref":"SagaTransactionsTable4F35CC88"}}},"functionName":"cancel-booking-stub","handler":"index.handler","memorySize":256,"role":{"Fn::GetAtt":["CancelBookingStubFnServiceRoleEB147118","Arn"]},"runtime":"nodejs20.x","timeout":15,"tracingConfig":{"mode":"Active"}}}}}},"PaymentStubFn":{"id":"PaymentStubFn","path":"AutoBookingStack/PaymentStubFn","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda_nodejs.NodejsFunction","version":"2.210.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"AutoBookingStack/PaymentStubFn/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.210.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"AutoBookingStack/PaymentStubFn/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.210.0","metadata":[]}},"Resource":{"id":"Resource","path":"AutoBookingStack/PaymentStubFn/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AutoBookingStack/PaymentStubFn/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/PaymentStubFn/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["xray:PutTraceSegments","xray:PutTelemetryRecords"],"Effect":"Allow","Resource":"*"},{"Action":["dynamodb:BatchGetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:Query","dynamodb:GetItem","dynamodb:Scan","dynamodb:ConditionCheckItem","dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["PaymentsIdempotencyTable0E5F63BF","Arn"]},{"Ref":"AWS::NoValue"}]},{"Action":["dynamodb:BatchGetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:Query","dynamodb:GetItem","dynamodb:Scan","dynamodb:ConditionCheckItem","dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["SagaTransactionsTable4F35CC88","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["SagaTransactionsTable4F35CC88","Arn"]},"/index/*"]]}]}],"Version":"2012-10-17"},"policyName":"PaymentStubFnServiceRoleDefaultPolicy3157A75C","roles":[{"Ref":"PaymentStubFnServiceRoleD0485132"}]}}}}}}},"Code":{"id":"Code","path":"AutoBookingStack/PaymentStubFn/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.210.0"},"children":{"Stage":{"id":"Stage","path":"AutoBookingStack/PaymentStubFn/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.210.0"}},"AssetBucket":{"id":"AssetBucket","path":"AutoBookingStack/PaymentStubFn/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.210.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"AutoBookingStack/PaymentStubFn/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-759262713606-us-east-1","s3Key":"53b8b49f788c6f157e99f7d84b5a392a2dd756910995a7065c1b2b81db661945.zip"},"environment":{"variables":{"PAYMENTS_IDEMPOTENCY_TABLE":{"Ref":"PaymentsIdempotencyTable0E5F63BF"},"SAGA_TRANSACTIONS_TABLE":{"Ref":"SagaTransactionsTable4F35CC88"}}},"functionName":"payment-stub","handler":"index.handler","memorySize":256,"role":{"Fn::GetAtt":["PaymentStubFnServiceRoleD0485132","Arn"]},"runtime":"nodejs20.x","timeout":15,"tracingConfig":{"mode":"Active"}}}}}},"AutoBookingSecretsKey":{"id":"AutoBookingSecretsKey","path":"AutoBookingStack/AutoBookingSecretsKey","constructInfo":{"fqn":"aws-cdk-lib.aws_kms.Key","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/AutoBookingSecretsKey/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_kms.CfnKey","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::KMS::Key","aws:cdk:cloudformation:props":{"description":"CMK for encrypting auto-booking secrets in SSM Parameter Store","enableKeyRotation":true,"keyPolicy":{"Statement":[{"Action":"kms:*","Effect":"Allow","Principal":{"AWS":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::759262713606:root"]]}},"Resource":"*"}],"Version":"2012-10-17"}}}},"Alias":{"id":"Alias","path":"AutoBookingStack/AutoBookingSecretsKey/Alias","constructInfo":{"fqn":"aws-cdk-lib.aws_kms.Alias","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/AutoBookingSecretsKey/Alias/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_kms.CfnAlias","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::KMS::Alias","aws:cdk:cloudformation:props":{"aliasName":"alias/auto-booking-secrets","targetKeyId":{"Fn::GetAtt":["AutoBookingSecretsKey9FEE6B42","Arn"]}}}}}}}},"StripeSecretParam":{"id":"StripeSecretParam","path":"AutoBookingStack/StripeSecretParam","constructInfo":{"fqn":"aws-cdk-lib.aws_ssm.StringParameter","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/StripeSecretParam/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ssm.CfnParameter","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SSM::Parameter","aws:cdk:cloudformation:props":{"description":"Stripe secret key for auto-booking (SecureString in all envs)","name":"/auto-booking/stripe-secret","type":"SecureString","value":"REPLACE_WITH_REAL_SECRET"}}}}},"PaymentStripeFn":{"id":"PaymentStripeFn","path":"AutoBookingStack/PaymentStripeFn","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda_nodejs.NodejsFunction","version":"2.210.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"AutoBookingStack/PaymentStripeFn/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.210.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"AutoBookingStack/PaymentStripeFn/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.210.0","metadata":[]}},"Resource":{"id":"Resource","path":"AutoBookingStack/PaymentStripeFn/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AutoBookingStack/PaymentStripeFn/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/PaymentStripeFn/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["xray:PutTraceSegments","xray:PutTelemetryRecords"],"Effect":"Allow","Resource":"*"},{"Action":["ssm:DescribeParameters","ssm:GetParameters","ssm:GetParameter","ssm:GetParameterHistory"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":ssm:us-east-1:759262713606:parameter",{"Ref":"StripeSecretParamA205E5C0"}]]}},{"Action":"kms:Decrypt","Effect":"Allow","Resource":{"Fn::GetAtt":["AutoBookingSecretsKey9FEE6B42","Arn"]}},{"Action":["dynamodb:BatchGetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:Query","dynamodb:GetItem","dynamodb:Scan","dynamodb:ConditionCheckItem","dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["PaymentsIdempotencyTable0E5F63BF","Arn"]},{"Ref":"AWS::NoValue"}]},{"Action":["dynamodb:BatchGetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:Query","dynamodb:GetItem","dynamodb:Scan","dynamodb:ConditionCheckItem","dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["SagaTransactionsTable4F35CC88","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["SagaTransactionsTable4F35CC88","Arn"]},"/index/*"]]}]}],"Version":"2012-10-17"},"policyName":"PaymentStripeFnServiceRoleDefaultPolicyD13B580F","roles":[{"Ref":"PaymentStripeFnServiceRole8872E082"}]}}}}}}},"Code":{"id":"Code","path":"AutoBookingStack/PaymentStripeFn/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.210.0"},"children":{"Stage":{"id":"Stage","path":"AutoBookingStack/PaymentStripeFn/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.210.0"}},"AssetBucket":{"id":"AssetBucket","path":"AutoBookingStack/PaymentStripeFn/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.210.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"AutoBookingStack/PaymentStripeFn/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-759262713606-us-east-1","s3Key":"f7435044bab23d06e22b8a7b44934be2e625542ffcd3abab428d579e7c0fbd75.zip"},"environment":{"variables":{"ENABLE_STRIPE":"false","STRIPE_SECRET_PARAM":{"Ref":"StripeSecretParamA205E5C0"},"PAYMENTS_IDEMPOTENCY_TABLE":{"Ref":"PaymentsIdempotencyTable0E5F63BF"},"SAGA_TRANSACTIONS_TABLE":{"Ref":"SagaTransactionsTable4F35CC88"}}},"functionName":"payment-stripe","handler":"index.handler","memorySize":256,"role":{"Fn::GetAtt":["PaymentStripeFnServiceRole8872E082","Arn"]},"runtime":"nodejs20.x","timeout":20,"tracingConfig":{"mode":"Active"}}}}}},"PendingCallbacksTable":{"id":"PendingCallbacksTable","path":"AutoBookingStack/PendingCallbacksTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/PendingCallbacksTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"correlationId","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","keySchema":[{"attributeName":"correlationId","keyType":"HASH"}],"tableName":"AutoBookingStack-pending-callbacks"}}},"ScalingRole":{"id":"ScalingRole","path":"AutoBookingStack/PendingCallbacksTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.210.0","metadata":[]}}}},"WebhookSecretParam":{"id":"WebhookSecretParam","path":"AutoBookingStack/WebhookSecretParam","constructInfo":{"fqn":"aws-cdk-lib.aws_ssm.StringParameter","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/WebhookSecretParam/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ssm.CfnParameter","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SSM::Parameter","aws:cdk:cloudformation:props":{"description":"Shared secret for provider webhook authentication","name":"/auto-booking/webhook-secret","type":"SecureString","value":"gfo4gvoqcvkynhrdx5v7"}}}}},"ProviderCallbackInitiateFn":{"id":"ProviderCallbackInitiateFn","path":"AutoBookingStack/ProviderCallbackInitiateFn","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda_nodejs.NodejsFunction","version":"2.210.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"AutoBookingStack/ProviderCallbackInitiateFn/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.210.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"AutoBookingStack/ProviderCallbackInitiateFn/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.210.0","metadata":[]}},"Resource":{"id":"Resource","path":"AutoBookingStack/ProviderCallbackInitiateFn/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AutoBookingStack/ProviderCallbackInitiateFn/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/ProviderCallbackInitiateFn/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["xray:PutTraceSegments","xray:PutTelemetryRecords"],"Effect":"Allow","Resource":"*"},{"Action":["dynamodb:BatchGetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:Query","dynamodb:GetItem","dynamodb:Scan","dynamodb:ConditionCheckItem","dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["PendingCallbacksTable09DC58B0","Arn"]},{"Ref":"AWS::NoValue"}]},{"Action":["dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["SagaTransactionsTable4F35CC88","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["SagaTransactionsTable4F35CC88","Arn"]},"/index/*"]]}]}],"Version":"2012-10-17"},"policyName":"ProviderCallbackInitiateFnServiceRoleDefaultPolicyC1916FA3","roles":[{"Ref":"ProviderCallbackInitiateFnServiceRole2457BFED"}]}}}}}}},"Code":{"id":"Code","path":"AutoBookingStack/ProviderCallbackInitiateFn/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.210.0"},"children":{"Stage":{"id":"Stage","path":"AutoBookingStack/ProviderCallbackInitiateFn/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.210.0"}},"AssetBucket":{"id":"AssetBucket","path":"AutoBookingStack/ProviderCallbackInitiateFn/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.210.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"AutoBookingStack/ProviderCallbackInitiateFn/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-759262713606-us-east-1","s3Key":"b8d2b75f9d4afc74d264e411a35d2e50a9de0c82335c38d2d496be870169b353.zip"},"environment":{"variables":{"CALLBACK_TABLE":{"Ref":"PendingCallbacksTable09DC58B0"}}},"functionName":"provider-callback-initiate","handler":"index.handler","memorySize":256,"role":{"Fn::GetAtt":["ProviderCallbackInitiateFnServiceRole2457BFED","Arn"]},"runtime":"nodejs20.x","timeout":30,"tracingConfig":{"mode":"Active"}}}}}},"ProviderWebhookCompleteFn":{"id":"ProviderWebhookCompleteFn","path":"AutoBookingStack/ProviderWebhookCompleteFn","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda_nodejs.NodejsFunction","version":"2.210.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"AutoBookingStack/ProviderWebhookCompleteFn/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.210.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"AutoBookingStack/ProviderWebhookCompleteFn/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.210.0","metadata":[]}},"Resource":{"id":"Resource","path":"AutoBookingStack/ProviderWebhookCompleteFn/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AutoBookingStack/ProviderWebhookCompleteFn/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/ProviderWebhookCompleteFn/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["xray:PutTraceSegments","xray:PutTelemetryRecords"],"Effect":"Allow","Resource":"*"},{"Action":["dynamodb:BatchGetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:Query","dynamodb:GetItem","dynamodb:Scan","dynamodb:ConditionCheckItem","dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["PendingCallbacksTable09DC58B0","Arn"]},{"Ref":"AWS::NoValue"}]},{"Action":["ssm:DescribeParameters","ssm:GetParameters","ssm:GetParameter","ssm:GetParameterHistory"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":ssm:us-east-1:759262713606:parameter",{"Ref":"WebhookSecretParam29432A84"}]]}},{"Action":"kms:Decrypt","Effect":"Allow","Resource":{"Fn::GetAtt":["AutoBookingSecretsKey9FEE6B42","Arn"]}},{"Action":["states:SendTaskSuccess","states:SendTaskFailure"],"Effect":"Allow","Resource":"*"},{"Action":["dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["SagaTransactionsTable4F35CC88","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["SagaTransactionsTable4F35CC88","Arn"]},"/index/*"]]}]}],"Version":"2012-10-17"},"policyName":"ProviderWebhookCompleteFnServiceRoleDefaultPolicy54529196","roles":[{"Ref":"ProviderWebhookCompleteFnServiceRole08AAE152"}]}}}}}}},"Code":{"id":"Code","path":"AutoBookingStack/ProviderWebhookCompleteFn/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.210.0"},"children":{"Stage":{"id":"Stage","path":"AutoBookingStack/ProviderWebhookCompleteFn/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.210.0"}},"AssetBucket":{"id":"AssetBucket","path":"AutoBookingStack/ProviderWebhookCompleteFn/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.210.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"AutoBookingStack/ProviderWebhookCompleteFn/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-759262713606-us-east-1","s3Key":"d3b9066cdc3d64ca6268cb1dcb15550bc08c8263ad2ac3addf619ac9cb939bd1.zip"},"environment":{"variables":{"CALLBACK_TABLE":{"Ref":"PendingCallbacksTable09DC58B0"},"WEBHOOK_SECRET_PARAM":{"Ref":"WebhookSecretParam29432A84"}}},"functionName":"provider-webhook-complete","handler":"index.handler","memorySize":256,"role":{"Fn::GetAtt":["ProviderWebhookCompleteFnServiceRole08AAE152","Arn"]},"runtime":"nodejs20.x","timeout":30,"tracingConfig":{"mode":"Active"}}}}}},"AutoBookingStateMachine":{"id":"AutoBookingStateMachine","path":"AutoBookingStack/AutoBookingStateMachine","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.StateMachine","version":"2.210.0","metadata":[]},"children":{"DefinitionBody":{"id":"DefinitionBody","path":"AutoBookingStack/AutoBookingStateMachine/DefinitionBody","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.210.0"},"children":{"Stage":{"id":"Stage","path":"AutoBookingStack/AutoBookingStateMachine/DefinitionBody/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.210.0"}},"AssetBucket":{"id":"AssetBucket","path":"AutoBookingStack/AutoBookingStateMachine/DefinitionBody/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.210.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"AutoBookingStack/AutoBookingStateMachine/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.CfnStateMachine","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::StepFunctions::StateMachine","aws:cdk:cloudformation:props":{"definitionS3Location":{"bucket":"cdk-hnb659fds-assets-759262713606-us-east-1","key":"dc1e88373047638564730ac776707826cd5b1ef2aa0d7dd54c4ae2ff4018f68c.json"},"loggingConfiguration":{"destinations":[{"cloudWatchLogsLogGroup":{"logGroupArn":{"Fn::GetAtt":["AutoBookingStateMachineLogs08476C0D","Arn"]}}}],"includeExecutionData":false,"level":"ERROR"},"roleArn":{"Fn::GetAtt":["AutoBookingStateMachineRoleFBA00017","Arn"]},"stateMachineName":"AutoBookingStack-auto-booking","tracingConfiguration":{"enabled":true}}}}}},"PaymentsIdempotencyTable":{"id":"PaymentsIdempotencyTable","path":"AutoBookingStack/PaymentsIdempotencyTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/PaymentsIdempotencyTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"idempotencyKey","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","keySchema":[{"attributeName":"idempotencyKey","keyType":"HASH"}],"pointInTimeRecoverySpecification":{"pointInTimeRecoveryEnabled":true},"tableName":"AutoBookingStack-payments-idempotency","timeToLiveSpecification":{"attributeName":"ttl","enabled":true}}}},"ScalingRole":{"id":"ScalingRole","path":"AutoBookingStack/PaymentsIdempotencyTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.210.0","metadata":[]}}}},"SagaTransactionsTable":{"id":"SagaTransactionsTable","path":"AutoBookingStack/SagaTransactionsTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/SagaTransactionsTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"transactionId","attributeType":"S"},{"attributeName":"stepId","attributeType":"S"},{"attributeName":"correlationId","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","globalSecondaryIndexes":[{"indexName":"CorrelationIdIndex","keySchema":[{"attributeName":"correlationId","keyType":"HASH"}],"projection":{"projectionType":"ALL"}}],"keySchema":[{"attributeName":"transactionId","keyType":"HASH"},{"attributeName":"stepId","keyType":"RANGE"}],"pointInTimeRecoverySpecification":{"pointInTimeRecoveryEnabled":true},"tableName":"AutoBookingStack-saga-transactions","timeToLiveSpecification":{"attributeName":"ttl","enabled":true}}}},"ScalingRole":{"id":"ScalingRole","path":"AutoBookingStack/SagaTransactionsTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.210.0","metadata":[]}}}},"AutoBookingDashboard":{"id":"AutoBookingDashboard","path":"AutoBookingStack/AutoBookingDashboard","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Dashboard","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/AutoBookingDashboard/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnDashboard","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Dashboard","aws:cdk:cloudformation:props":{"dashboardBody":{"Fn::Join":["",["{\"widgets\":[{\"type\":\"metric\",\"width\":12,\"height\":6,\"x\":0,\"y\":0,\"properties\":{\"view\":\"timeSeries\",\"title\":\"Executions Succeeded/Failed\",\"region\":\"",{"Ref":"AWS::Region"},"\",\"metrics\":[[\"AWS/States\",\"ExecutionsSucceeded\",\"StateMachineArn\",\"",{"Ref":"AutoBookingStateMachineDBFA4D30"},"\",{\"stat\":\"Sum\"}],[\"AWS/States\",\"ExecutionsFailed\",\"StateMachineArn\",\"",{"Ref":"AutoBookingStateMachineDBFA4D30"},"\",{\"stat\":\"Sum\",\"yAxis\":\"right\"}]],\"yAxis\":{}}},{\"type\":\"metric\",\"width\":12,\"height\":6,\"x\":12,\"y\":0,\"properties\":{\"view\":\"timeSeries\",\"title\":\"Execution Time (ms)\",\"region\":\"",{"Ref":"AWS::Region"},"\",\"metrics\":[[\"AWS/States\",\"ExecutionTime\",\"StateMachineArn\",\"",{"Ref":"AutoBookingStateMachineDBFA4D30"},"\"]],\"yAxis\":{}}}]}"]]},"dashboardName":"auto-booking-dashboard"}}}}},"AutoBookingFailuresAlarm":{"id":"AutoBookingFailuresAlarm","path":"AutoBookingStack/AutoBookingFailuresAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/AutoBookingFailuresAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmDescription":"Step Functions executions failing","alarmName":"auto-booking-failures","comparisonOperator":"GreaterThanOrEqualToThreshold","datapointsToAlarm":2,"dimensions":[{"name":"StateMachineArn","value":{"Ref":"AutoBookingStateMachineDBFA4D30"}}],"evaluationPeriods":2,"metricName":"ExecutionsFailed","namespace":"AWS/States","period":300,"statistic":"Sum","threshold":1,"treatMissingData":"notBreaching"}}}}},"StateMachineArn":{"id":"StateMachineArn","path":"AutoBookingStack/StateMachineArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"ValidateInputLambdaArn":{"id":"ValidateInputLambdaArn","path":"AutoBookingStack/ValidateInputLambdaArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"ProcessBookingLambdaArn":{"id":"ProcessBookingLambdaArn","path":"AutoBookingStack/ProcessBookingLambdaArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"PaymentStubLambdaArn":{"id":"PaymentStubLambdaArn","path":"AutoBookingStack/PaymentStubLambdaArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"RefundPaymentLambdaArn":{"id":"RefundPaymentLambdaArn","path":"AutoBookingStack/RefundPaymentLambdaArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"CancelBookingLambdaArn":{"id":"CancelBookingLambdaArn","path":"AutoBookingStack/CancelBookingLambdaArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"PaymentsIdempotencyTableName":{"id":"PaymentsIdempotencyTableName","path":"AutoBookingStack/PaymentsIdempotencyTableName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"SagaTransactionsTableName":{"id":"SagaTransactionsTableName","path":"AutoBookingStack/SagaTransactionsTableName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"CallbackTableName":{"id":"CallbackTableName","path":"AutoBookingStack/CallbackTableName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"ProviderCallbackInitiateArn":{"id":"ProviderCallbackInitiateArn","path":"AutoBookingStack/ProviderCallbackInitiateArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"ProviderWebhookCompleteArn":{"id":"ProviderWebhookCompleteArn","path":"AutoBookingStack/ProviderWebhookCompleteArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"DashboardName":{"id":"DashboardName","path":"AutoBookingStack/DashboardName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"FailuresAlarmName":{"id":"FailuresAlarmName","path":"AutoBookingStack/FailuresAlarmName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"AutoBookingFailuresTopic":{"id":"AutoBookingFailuresTopic","path":"AutoBookingStack/AutoBookingFailuresTopic","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.Topic","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/AutoBookingFailuresTopic/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.CfnTopic","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SNS::Topic","aws:cdk:cloudformation:props":{"displayName":"Auto Booking Failures","topicName":"auto-booking-failures-topic"}}},"Policy":{"id":"Policy","path":"AutoBookingStack/AutoBookingFailuresTopic/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.TopicPolicy","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/AutoBookingFailuresTopic/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.CfnTopicPolicy","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SNS::TopicPolicy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"sns:Publish","Effect":"Allow","Principal":{"Service":"events.amazonaws.com"},"Resource":{"Ref":"AutoBookingFailuresTopicE91B2345"},"Sid":"0"}],"Version":"2012-10-17"},"topics":[{"Ref":"AutoBookingFailuresTopicE91B2345"}]}}}}},"prkr.sb@gmail.com":{"id":"prkr.sb@gmail.com","path":"AutoBookingStack/AutoBookingFailuresTopic/prkr.sb@gmail.com","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.Subscription","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/AutoBookingFailuresTopic/prkr.sb@gmail.com/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.CfnSubscription","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SNS::Subscription","aws:cdk:cloudformation:props":{"endpoint":"prkr.sb@gmail.com","protocol":"email","topicArn":{"Ref":"AutoBookingFailuresTopicE91B2345"}}}}}}}},"SfnFailuresRule":{"id":"SfnFailuresRule","path":"AutoBookingStack/SfnFailuresRule","constructInfo":{"fqn":"aws-cdk-lib.aws_events.Rule","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/SfnFailuresRule/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_events.CfnRule","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Events::Rule","aws:cdk:cloudformation:props":{"description":"Route Step Functions failed/timed-out/aborted executions to SNS","eventPattern":{"source":["aws.states"],"detail-type":["Step Functions Execution Status Change"],"detail":{"status":["FAILED","TIMED_OUT","ABORTED"],"stateMachineArn":[{"Ref":"AutoBookingStateMachineDBFA4D30"}]}},"state":"ENABLED","targets":[{"id":"Target0","arn":{"Ref":"AutoBookingFailuresTopicE91B2345"}}]}}}}},"FailuresSnsTopicArn":{"id":"FailuresSnsTopicArn","path":"AutoBookingStack/FailuresSnsTopicArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"AutoBookingHttpApi":{"id":"AutoBookingHttpApi","path":"AutoBookingStack/AutoBookingHttpApi","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpApi","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/AutoBookingHttpApi/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnApi","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Api","aws:cdk:cloudformation:props":{"corsConfiguration":{"allowHeaders":["*"],"allowMethods":["*"],"allowOrigins":["*"]},"name":"auto-booking-api","protocolType":"HTTP"}}},"DefaultStage":{"id":"DefaultStage","path":"AutoBookingStack/AutoBookingHttpApi/DefaultStage","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpStage","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/AutoBookingHttpApi/DefaultStage/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnStage","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Stage","aws:cdk:cloudformation:props":{"apiId":{"Ref":"AutoBookingHttpApiA2851C68"},"autoDeploy":true,"stageName":"$default"}}}}},"POST--provider--webhook":{"id":"POST--provider--webhook","path":"AutoBookingStack/AutoBookingHttpApi/POST--provider--webhook","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpRoute","version":"2.210.0","metadata":[]},"children":{"WebhookIntegration":{"id":"WebhookIntegration","path":"AutoBookingStack/AutoBookingHttpApi/POST--provider--webhook/WebhookIntegration","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpIntegration","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AutoBookingStack/AutoBookingHttpApi/POST--provider--webhook/WebhookIntegration/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnIntegration","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Integration","aws:cdk:cloudformation:props":{"apiId":{"Ref":"AutoBookingHttpApiA2851C68"},"integrationType":"AWS_PROXY","integrationUri":{"Fn::GetAtt":["ProviderWebhookCompleteFn04DBFBB3","Arn"]},"payloadFormatVersion":"2.0"}}}}},"WebhookIntegration-Permission":{"id":"WebhookIntegration-Permission","path":"AutoBookingStack/AutoBookingHttpApi/POST--provider--webhook/WebhookIntegration-Permission","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["ProviderWebhookCompleteFn04DBFBB3","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":execute-api:us-east-1:759262713606:",{"Ref":"AutoBookingHttpApiA2851C68"},"/*/*/provider/webhook"]]}}}},"Resource":{"id":"Resource","path":"AutoBookingStack/AutoBookingHttpApi/POST--provider--webhook/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"AutoBookingHttpApiA2851C68"},"authorizationType":"NONE","routeKey":"POST /provider/webhook","target":{"Fn::Join":["",["integrations/",{"Ref":"AutoBookingHttpApiPOSTproviderwebhookWebhookIntegration9C9296EB"}]]}}}}}}}},"WebhookUrl":{"id":"WebhookUrl","path":"AutoBookingStack/WebhookUrl","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"WebhookSecretParameter":{"id":"WebhookSecretParameter","path":"AutoBookingStack/WebhookSecretParameter","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"AutoBookingStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"AutoBookingStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.210.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"AutoBookingStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.210.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"AutoBookingStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.210.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}}}}